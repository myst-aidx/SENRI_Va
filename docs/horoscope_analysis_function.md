# ホロスコープ分析関数について

このドキュメントでは、占いチャットボットで使用しているホロスコープ分析関数について説明します。この関数は、ユーザーの出生データに基づいてホロスコープを分析し、運勢を生成するために使用されます。

## 関数の概要

この関数は、ユーザーの出生日時と出生場所を受け取り、以下の情報を出力します。

*   **ネイタルチャート（出生図）:**  生まれた瞬間の惑星の位置を示す図。
*   **主要なアスペクト:** 惑星同士が形成する主要な角度（コンジャンクション、セクスタイル、スクエア、トライン、オポジション）。
*   **ハウス:**  惑星が位置するハウス（人生の特定の領域を示す）。
*   **トランジット:**  特定の日時における惑星の実際の位置。
*   **トランジットとネイタルの惑星の比較:**  トランジットの惑星がネイタルの惑星と形成するアスペクト。

これらの情報を基に、総合的な運勢を生成します。

## 関数の入力

*   `birthDate`: ユーザーの出生日時（例: "1990-01-01T12:00:00+09:00"）。
*   `birthLocation`: ユーザーの出生場所（例: { latitude: 35.6895, longitude: 139.6917 }）。
*   `targetDate`: 運勢を分析する日付（オプション。指定しない場合は現在の日付）。

## 関数の出力

関数の出力は、以下の情報を含むオブジェクトです。

```typescript
{
  natalChart: { ... }, // ネイタルチャートの情報
  majorAspects: [ ... ], // 主要なアスペクトの情報
  houses: { ... }, // ハウスの情報
  transits: { ... }, // トランジットの情報
  transitAspects: [ ... ], // トランジットとネイタルの惑星の比較情報
  dailyFortune: string // 生成された日々の運勢
}
```

## 関数の実装詳細

1. **出生データの処理:**  入力された出生日時と出生場所を基に、正確な天体位置を計算するためのデータ形式に変換します。
2. **ネイタルチャートの作成:**  占星術ライブラリ（例: "astronomy-bundle"）を使用して、生まれた瞬間の惑星の位置を計算し、ネイタルチャートを作成します。
3. **主要なアスペクトの検出:**  ネイタルチャート内の惑星同士が形成する主要なアスペクトを検出します。
4. **ハウスの決定:**  生まれた瞬間のアセンダント（上昇宮）を計算し、各惑星がどのハウスに位置するかを決定します。
5. **トランジットデータの取得:**  `targetDate`に基づいて、惑星のトランジット位置を取得します。
6. **トランジットとネイタルの惑星の比較:**  トランジットの惑星とネイタルの惑星が形成するアスペクトを計算します。
7. **運勢の生成:**  検出されたアスペクトやハウスの位置に基づき、事前に定義されたルールやテンプレートを用いて運勢を生成します。

## 使用する占星術ライブラリ

*   **astronomy-bundle:**  JavaScriptで利用可能な強力な占星術ライブラリ。正確な天体計算やアスペクトの検出、ハウスの決定などの機能を提供します。

## 今後の展望

*   **運勢生成ロジックの改善:**  より複雑な占星術の解釈を取り入れ、運勢の精度を高める予定です。
*   **ユーザーインターフェースとの連携:**  分析結果をユーザーフレンドリーな形式で表示するためのインターフェースを開発します。

## 注意事項

*   占星術は解釈の幅が広いため、生成される運勢はあくまで参考としてください。
*   正確な分析を行うためには、正確な出生データが必要です。
